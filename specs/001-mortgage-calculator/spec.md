# Feature Specification: 房屋貸款試算工具

**Feature Branch**: `001-mortgage-calculator`
**Created**: 2025-12-05
**Status**: Draft
**Input**: User description: "房屋貸款試算小工具 - 輸入房屋總價、貸款金額或成數（可切換）、貸款年限（預設30年）、利率（預設2.5%）、還款方式（等額本息或等額本金），試算後顯示每月還款金額"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 基本房貸試算 (Priority: P1)

身為一位購屋者，我想要輸入貸款條件並立即看到每月還款金額，以便評估我的財務負擔能力。

**Why this priority**: 這是工具的核心價值，沒有試算功能就沒有產品存在的意義。使用者最基本的需求就是知道每月要還多少錢。

**Independent Test**: 可透過輸入貸款金額、年限、利率後點擊試算，驗證是否正確顯示每月還款金額。

**Acceptance Scenarios**:

1. **Given** 使用者在試算頁面，**When** 輸入貸款金額 800 萬、年限 30 年、利率 2.5%、選擇等額本息，**Then** 系統顯示每月還款金額約 31,603 元
2. **Given** 使用者在試算頁面，**When** 輸入貸款金額 800 萬、年限 30 年、利率 2.5%、選擇等額本金，**Then** 系統顯示首月還款金額約 38,889 元，並顯示每月遞減說明
3. **Given** 使用者未輸入任何資料，**When** 點擊試算按鈕，**Then** 系統提示必填欄位需要填寫

---

### User Story 2 - 貸款金額輸入切換 (Priority: P1)

身為一位購屋者，我想要能夠在「直接輸入貸款金額」和「輸入貸款成數」之間切換，因為有時我知道確切金額，有時我只知道想貸幾成。

**Why this priority**: 這是使用者明確要求的功能，且直接影響輸入體驗。不同使用者有不同的思考方式，此功能讓工具更具彈性。

**Independent Test**: 可透過切換輸入模式，驗證系統能正確接受金額或成數輸入，並正確計算結果。

**Acceptance Scenarios**:

1. **Given** 使用者選擇「貸款金額」模式，**When** 輸入 800 萬，**Then** 系統以 800 萬作為貸款金額進行試算
2. **Given** 使用者選擇「貸款成數」模式且已輸入房屋總價 1000 萬，**When** 輸入 8 成，**Then** 系統自動計算貸款金額為 800 萬並進行試算
3. **Given** 使用者在「貸款成數」模式，**When** 未輸入房屋總價就輸入成數，**Then** 系統提示需先輸入房屋總價

---

### User Story 3 - 利率類型切換 (Priority: P1)

身為一位購屋者，我想要能夠選擇固定利率或浮動利率，因為不同的利率方案會影響我的還款規劃。

**Why this priority**: 利率類型是影響貸款成本的重要因素，許多購屋者需要比較固定與浮動利率的差異來做決策。

**Independent Test**: 可透過切換利率類型，驗證系統正確計算並顯示不同利率方案的結果。

**Acceptance Scenarios**:

1. **Given** 使用者選擇「固定利率」，**When** 輸入利率 2.5% 並進行試算，**Then** 系統以全期固定 2.5% 計算每月還款金額
2. **Given** 使用者選擇「浮動利率」，**When** 輸入首期利率與預估調整幅度，**Then** 系統顯示利率變動對還款金額的影響說明
3. **Given** 使用者在浮動利率模式，**When** 查看試算結果，**Then** 系統顯示利率變動風險提示

---

### User Story 4 - 預設值便利輸入 (Priority: P2)

身為一位購屋者，我希望常用的參數已有預設值，這樣我只需調整少數欄位就能快速試算。

**Why this priority**: 預設值能大幅提升使用效率，讓使用者更快得到結果。但這是增強體驗，不是核心功能。

**Independent Test**: 可透過開啟試算頁面，驗證年限預設為 30 年、利率預設為 2.5%、利率類型預設為固定利率。

**Acceptance Scenarios**:

1. **Given** 使用者首次開啟試算頁面，**When** 頁面載入完成，**Then** 貸款年限顯示預設值 30 年
2. **Given** 使用者首次開啟試算頁面，**When** 頁面載入完成，**Then** 貸款利率顯示預設值 2.5%
3. **Given** 使用者首次開啟試算頁面，**When** 頁面載入完成，**Then** 利率類型預設為「固定利率」
4. **Given** 使用者修改預設值，**When** 進行試算，**Then** 系統使用修改後的數值計算

---

### User Story 5 - 即時計算結果與可視化 (Priority: P1)

身為一位購屋者，我想要在輸入條件後即時看到完整的試算結果，包含總還款金額、總利息、本金利息比例以及還款曲線圖，以便全面了解貸款的財務影響。

**Why this priority**: 完整的試算結果是使用者做出貸款決策的關鍵資訊，視覺化的還款曲線能幫助使用者更直觀地理解還款過程，這是核心功能的重要延伸。

**Independent Test**: 可透過輸入貸款條件後，驗證系統是否即時顯示所有計算結果並繪製正確的還款曲線圖。

**Acceptance Scenarios**:

1. **Given** 使用者已輸入完整貸款條件，**When** 輸入任一參數變更，**Then** 系統即時更新所有計算結果（無需點擊按鈕）
2. **Given** 使用者輸入貸款金額 800 萬、年限 30 年、利率 2.5%、等額本息，**When** 試算完成，**Then** 系統顯示每月應付金額約 31,603 元、總還款金額約 11,377,080 元、總利息約 3,377,080 元
3. **Given** 使用者完成試算，**When** 查看結果區域，**Then** 系統顯示首月還款的利息與本金比例（例如：利息 16,667 元 占 52.7%、本金 14,936 元 占 47.3%）
4. **Given** 使用者完成試算，**When** 查看圖表區域，**Then** 系統顯示還款曲線折線圖，X軸為期數（月）、Y軸為金額，包含本金與利息兩條曲線
5. **Given** 使用者選擇等額本金還款方式，**When** 查看圖表，**Then** 還款曲線顯示每月本金固定、利息逐月遞減的趨勢

---

### User Story 6 - 完整還款明細表 (Priority: P1)

身為一位購屋者，我想要查看每個月的詳細還款明細，包含應付總額、本金、利息和剩餘本金，以便清楚了解整個還款過程的資金流向。

**Why this priority**: 還款明細表是使用者做財務規劃的重要依據，能夠讓使用者清楚知道每期還款的組成，這是核心試算功能的必要延伸。

**Independent Test**: 可透過完成試算後，驗證系統是否顯示完整的還款明細表，且每期資料正確。

**Acceptance Scenarios**:

1. **Given** 使用者完成貸款試算，**When** 查看還款明細區域，**Then** 系統顯示每期還款明細表，包含期數、應付總額、本金、利息、剩餘本金五個欄位
2. **Given** 使用者輸入貸款金額 800 萬、年限 30 年、利率 2.5%、等額本息，**When** 查看第 1 期明細，**Then** 顯示應付總額約 31,603 元、本金約 14,936 元、利息約 16,667 元、剩餘本金約 7,985,064 元
3. **Given** 使用者查看等額本息的還款明細表，**When** 檢視各期資料，**Then** 應付總額每期相同，本金逐期增加，利息逐期減少
4. **Given** 使用者查看等額本金的還款明細表，**When** 檢視各期資料，**Then** 本金每期相同，利息與應付總額逐期減少
5. **Given** 使用者查看還款明細表的最後一期，**When** 檢視剩餘本金欄位，**Then** 剩餘本金應為 0 元（或因四捨五入誤差為極小值）
6. **Given** 還款明細表資料量較大（例如 360 期），**When** 使用者瀏覽明細表，**Then** 系統提供分頁或虛擬捲動機制以維持效能

---

### User Story 7 - 數字格式化與可讀性 (Priority: P2)

身為一位購屋者，我希望所有金額都有千分位分隔符號，並且計算結果有簡短的說明文字，讓我更容易閱讀和理解試算結果。

**Why this priority**: 良好的數字格式化能大幅提升閱讀體驗，但這是顯示層面的增強，不影響核心計算功能。

**Independent Test**: 可透過檢視任何金額欄位，驗證是否正確顯示千分位格式。

**Acceptance Scenarios**:

1. **Given** 系統顯示任何金額數值，**When** 使用者查看該數值，**Then** 金額自動加上千分位分隔符號（例如：8,000,000 元）
2. **Given** 使用者輸入金額時，**When** 輸入數字，**Then** 系統自動將輸入值格式化為千分位顯示
3. **Given** 使用者完成 30 年期貸款試算，**When** 查看試算結果，**Then** 系統顯示提示說明（例如：「30 年期總共需支付利息 3,377,080 元」）
4. **Given** 使用者修改貸款年限從 30 年改為 20 年，**When** 查看試算結果，**Then** 系統顯示比較說明（例如：「與 30 年期相比，每月多付 X 元，但總利息減少 Y 元」）

---

### User Story 8 - 建立方案比較 (Priority: P1)

身為一位購屋者，我想要同時比較兩個不同的貸款方案（例如不同利率、不同年限或不同還款方式），以便做出最有利的貸款決策。

**Why this priority**: 這是比較功能的核心價值，沒有建立比較的能力就無法進行任何分析。使用者最基本的需求是能夠將兩個方案放在一起對比。

**Independent Test**: 可透過設定兩組不同的貸款條件，驗證系統是否能並排顯示兩個方案的計算結果。

**Acceptance Scenarios**:

1. **Given** 使用者已完成方案 A 的試算，**When** 點擊「新增比較方案」，**Then** 系統顯示方案 B 的輸入區域，保留方案 A 的數據
2. **Given** 使用者設定方案 A（利率 2.5%、30 年）和方案 B（利率 2.2%、20 年），**When** 兩方案皆完成輸入，**Then** 系統並排顯示兩方案的每月還款、總利息、總還款金額
3. **Given** 使用者正在比較兩個方案，**When** 修改任一方案的參數，**Then** 比較結果即時更新
4. **Given** 使用者只有一個方案，**When** 查看比較區域，**Then** 系統提示需新增第二個方案才能進行比較

---

### User Story 9 - 差異分析與提示 (Priority: P1)

身為一位購屋者，我想要看到兩個方案之間的關鍵差異分析和建議提示，以便快速理解哪個方案更適合我。

**Why this priority**: 單純顯示數字不夠直觀，使用者需要系統幫助分析差異並給出有意義的提示，這是比較功能的關鍵價值所在。

**Independent Test**: 可透過設定兩個有明顯差異的方案，驗證系統是否正確計算差異值並顯示相應的提示文字。

**Acceptance Scenarios**:

1. **Given** 方案 A 總利息 300 萬、方案 B 總利息 250 萬，**When** 查看比較結果，**Then** 系統顯示「方案 B 可省下 50 萬利息」
2. **Given** 方案 A 每月還款 31,603 元、方案 B 每月還款 45,000 元，**When** 查看比較結果，**Then** 系統顯示「方案 B 每月多付 13,397 元」
3. **Given** 方案 A 利率 2.5%、方案 B 利率 2.2%，**When** 查看比較結果，**Then** 系統顯示利率差異提示「利率差 0.3%，總利息差 XX 萬」
4. **Given** 兩個方案的還款年限不同（30 年 vs 20 年），**When** 查看比較結果，**Then** 系統顯示還款壓力與總成本的權衡說明

---

### User Story 10 - 比較視覺化圖表 (Priority: P1)

身為一位購屋者，我想要透過圖表視覺化地比較兩個方案的還款趨勢，以便更直觀地理解差異。

**Why this priority**: 視覺化圖表能讓使用者一眼看出兩個方案的差異，特別是在長期還款過程中的變化趨勢，是做決策的重要輔助工具。

**Independent Test**: 可透過設定兩個方案，驗證系統是否在同一圖表中顯示兩條還款曲線。

**Acceptance Scenarios**:

1. **Given** 使用者已設定兩個比較方案，**When** 查看圖表區域，**Then** 系統顯示兩個方案的還款曲線在同一圖表中
2. **Given** 使用者查看比較圖表，**When** 滑鼠移到任一數據點，**Then** 顯示該點的詳細數值（期數、方案 A 金額、方案 B 金額）
3. **Given** 使用者查看比較圖表，**When** 選擇「總利息累計圖」，**Then** 系統切換顯示兩方案的累計利息成長曲線
4. **Given** 使用者查看比較圖表，**When** 選擇「每月還款對比圖」，**Then** 系統顯示兩方案每月還款金額的柱狀對比圖

---

### User Story 11 - 快速方案切換與調整 (Priority: P2)

身為一位購屋者，我想要能夠快速複製現有方案並微調參數，以便探索不同情境下的最佳選擇。

**Why this priority**: 快速複製和調整能大幅提升比較效率，但這是增強體驗，核心比較功能不依賴此功能。

**Independent Test**: 可透過複製現有方案按鈕，驗證系統是否正確複製所有參數到新方案。

**Acceptance Scenarios**:

1. **Given** 使用者已設定方案 A 的完整參數，**When** 點擊「複製到方案 B」，**Then** 方案 B 自動填入方案 A 的所有參數
2. **Given** 使用者已複製方案，**When** 修改方案 B 的單一參數（如利率），**Then** 只有被修改的參數改變，其他維持複製值
3. **Given** 使用者正在比較兩方案，**When** 點擊「交換 A/B」，**Then** 方案 A 與方案 B 的位置互換
4. **Given** 使用者想清除比較，**When** 點擊「清除方案 B」，**Then** 方案 B 被清空，回到單方案狀態

---

### User Story 12 - 比較結果摘要與分享 (Priority: P3)

身為一位購屋者，我想要將比較結果匯出或分享給家人討論，以便共同做出貸款決策。

**Why this priority**: 分享功能是便利性增強，核心比較功能不依賴此功能，但對於需要與他人討論的使用者有價值。

**Independent Test**: 可透過點擊分享按鈕，驗證系統是否產生可分享的比較摘要。

**Acceptance Scenarios**:

1. **Given** 使用者完成兩方案比較，**When** 點擊「產生摘要」，**Then** 系統顯示文字版比較摘要，包含關鍵數據對比
2. **Given** 使用者查看比較摘要，**When** 點擊「複製到剪貼簿」，**Then** 摘要文字被複製，可貼到其他應用程式
3. **Given** 使用者完成比較，**When** 點擊「截圖比較表」，**Then** 系統產生比較表格的圖片檔案供下載

---

### User Story 13 - 儲存多組試算結果 (Priority: P2)

身為一位購屋者，我想要儲存多組試算結果，以便稍後回顧比較或分享給家人討論。

**Why this priority**: 儲存功能讓使用者可以累積比較資料，不用重複輸入，提升長期使用價值，但不影響核心試算功能。

**Independent Test**: 可透過完成試算後點擊儲存，驗證結果是否正確保存並可重新載入。

**Acceptance Scenarios**:

1. **Given** 使用者完成一次試算，**When** 點擊「儲存此結果」按鈕，**Then** 系統將此次試算條件與結果儲存至本機
2. **Given** 使用者已儲存多組試算結果，**When** 查看「已儲存的試算」列表，**Then** 系統顯示每組結果的摘要（貸款金額、年限、每月還款）
3. **Given** 使用者在「已儲存的試算」列表中選擇一組結果，**When** 點擊「載入」按鈕，**Then** 系統自動填入該組試算條件並顯示結果
4. **Given** 使用者在「已儲存的試算」列表中，**When** 點擊某組結果的「刪除」按鈕，**Then** 系統移除該組儲存的結果
5. **Given** 使用者已儲存超過 10 組結果，**When** 查看列表，**Then** 系統提供篩選或排序功能以便快速找到特定結果

---

### User Story 14 - 房貸負擔能力檢查 (Priority: P1)

身為一位購屋者，我想要輸入我的每月收入，讓系統告訴我合理的貸款額度範圍，以便了解自己的購屋能力。

**Why this priority**: 負擔能力評估幫助使用者在試算前先了解自己的財務極限，避免設定不切實際的貸款條件，這是輔助決策的重要功能。

**Independent Test**: 可透過輸入每月收入，驗證系統是否正確計算並顯示建議貸款額度。

**Acceptance Scenarios**:

1. **Given** 使用者在負擔能力檢查區域，**When** 輸入每月收入 80,000 元，**Then** 系統顯示建議最高月付款金額（例如：收入的 30% = 24,000 元）
2. **Given** 使用者已輸入每月收入，**When** 系統計算完成，**Then** 顯示以當前利率和年限設定下的建議最高貸款金額
3. **Given** 使用者查看負擔能力建議，**When** 建議月付款超過收入 30%，**Then** 系統顯示風險警示（黃色或紅色標示）
4. **Given** 使用者查看負擔能力建議，**When** 點擊「套用建議金額」按鈕，**Then** 系統自動將建議貸款金額填入試算欄位
5. **Given** 使用者修改利率或年限設定，**When** 查看負擔能力建議，**Then** 建議貸款金額即時更新

---

### User Story 15 - 自備款比例計算 (Priority: P2)

身為一位購屋者，我想要在輸入房屋總價後，系統自動計算並顯示我需要準備的自備款金額，以便規劃存款目標。

**Why this priority**: 自備款是購屋的重要財務準備項目，自動計算可協助使用者了解完整的資金需求，但這是輔助資訊，不影響核心試算。

**Independent Test**: 可透過輸入房屋總價和貸款成數，驗證系統是否正確顯示自備款金額和比例。

**Acceptance Scenarios**:

1. **Given** 使用者輸入房屋總價 1,500 萬且貸款成數為 8 成，**When** 查看自備款區域，**Then** 系統顯示自備款金額 300 萬（20%）
2. **Given** 使用者正在查看自備款資訊，**When** 修改貸款成數從 8 成改為 7 成，**Then** 自備款金額即時更新為 450 萬（30%）
3. **Given** 使用者使用「貸款金額」模式直接輸入金額，**When** 同時有輸入房屋總價，**Then** 系統自動計算並顯示對應的自備款比例
4. **Given** 使用者查看自備款資訊，**When** 系統偵測自備款比例低於 20%，**Then** 顯示提示說明（例如：「多數銀行要求自備款至少 20%」）

---

### Edge Cases

**基本輸入驗證**
- 當使用者輸入負數或零作為貸款金額時，系統應顯示錯誤提示
- 當使用者輸入超過 100% 的貸款成數時，系統應顯示錯誤提示
- 當使用者輸入利率為 0% 時，系統應能正確計算（無利息情況）
- 當使用者輸入非常大的金額（例如超過 10 億）時，系統應能正確處理或提示超出範圍
- 當使用者輸入小數點年限時（例如 20.5 年），系統應如何處理
- 當使用者快速切換貸款金額/成數模式時，已輸入的數值應如何處理
- 當使用者選擇浮動利率後又切回固定利率時，應清除浮動利率相關設定
- 當使用者輸入極端的利率變動幅度時（例如 +10%），系統應能正確計算或提示
- 當使用者輸入金額過長（超過 15 位數）時，系統應能正確處理千分位格式化
- 當使用者複製格式化後的金額時，應提供純數字版本供複製

**還款曲線與明細相關**
- 當貸款期數超過 600 期（50年）時，還款曲線圖應適當聚合資料點以維持效能
- 當視窗大小變更時，還款曲線圖應自適應調整尺寸
- 當首月本金為 0 元（極低利率或極長期限）時，本金比例應顯示為 0%
- 當還款明細表期數超過 100 期時，系統應提供篩選或跳轉特定期數的功能
- 當使用者快速捲動還款明細表時，系統應維持流暢的捲動體驗
- 當最後一期剩餘本金因四捨五入產生微小誤差（如 -3 元或 +2 元）時，應顯示為 0 元

**A/B 方案比較相關**
- 當兩個方案的參數完全相同時，系統應顯示「兩方案條件相同，無差異」提示
- 當使用者快速切換方案參數時，系統應防止過於頻繁的重新計算（節流處理）
- 當方案 A 使用等額本息、方案 B 使用等額本金時，應正確顯示不同還款方式的對比
- 當兩個方案的貸款年限差異很大時（如 10 年 vs 40 年），圖表 X 軸應適當調整
- 當使用者在比較模式中重新整理頁面時，應如何處理已輸入的比較資料
- 當螢幕寬度不足以並排顯示兩方案時，應改為上下堆疊顯示
- 當其中一個方案的輸入不完整時，應禁用比較功能並提示完成輸入
- 當比較圖表中資料點過多（超過 500 點）時，應適當聚合以維持效能
- 當使用者嘗試複製方案但目標方案已有資料時，應詢問是否覆蓋
- 當使用者嘗試比較超過 2 組方案時，系統應提示目前僅支援 2 組比較

**儲存與負擔能力相關**
- 當使用者儲存試算結果達到上限（例如 50 組）時，系統應提示需刪除舊資料
- 當本機儲存空間不足時，系統應提示無法儲存並建議清理空間
- 當使用者輸入每月收入為 0 或負數時，負擔能力檢查應顯示錯誤提示
- 當建議貸款金額低於最低可貸金額（例如 10 萬）時，應顯示適當提示
- 當使用者未輸入房屋總價就查看自備款區域時，應提示需先輸入房屋總價
- 當貸款成數為 100% 時，自備款應顯示為 0 元並提示「全額貸款」

## Requirements *(mandatory)*

### Functional Requirements

**輸入相關**

- **FR-001**: 系統必須提供房屋總價輸入欄位
- **FR-002**: 系統必須提供貸款金額輸入欄位
- **FR-003**: 系統必須提供貸款成數輸入欄位
- **FR-004**: 系統必須提供「貸款金額」與「貸款成數」之間的切換機制
- **FR-005**: 系統必須提供貸款年限輸入欄位，預設值為 30 年
- **FR-006**: 系統必須提供貸款利率輸入欄位，預設值為 2.5%
- **FR-007**: 系統必須提供利率類型選擇，包含「固定利率」與「浮動利率」兩種選項，預設為「固定利率」
- **FR-008**: 系統必須提供還款方式選擇，包含「等額本息」與「等額本金」兩種選項

**計算相關**

- **FR-009**: 當選擇「等額本息」時，系統必須使用標準等額本息公式計算每月還款金額
- **FR-010**: 當選擇「等額本金」時，系統必須計算首月還款金額及每月遞減金額
- **FR-011**: 當使用「貸款成數」模式時，系統必須根據房屋總價自動計算實際貸款金額
- **FR-012**: 當選擇「浮動利率」時，系統必須顯示利率變動對月付款金額的影響試算

**輸出相關**

- **FR-013**: 系統必須顯示計算後的每月還款金額
- **FR-014**: 當選擇「等額本金」時，系統必須顯示每月還款遞減的說明資訊
- **FR-015**: 當選擇「浮動利率」時，系統必須顯示利率變動風險提示說明
- **FR-016**: 系統必須顯示總還款金額（本金 + 總利息）
- **FR-017**: 系統必須顯示總利息金額
- **FR-018**: 系統必須顯示首月還款的利息與本金比例（金額與百分比）
- **FR-019**: 系統必須顯示還款曲線折線圖，X軸為期數、Y軸為金額
- **FR-020**: 還款曲線圖必須包含本金曲線與利息曲線兩條線
- **FR-021**: 系統必須在使用者輸入參數變更時即時更新計算結果（無需點擊按鈕）

**還款明細表相關**

- **FR-025**: 系統必須顯示完整還款明細表，包含每期的：期數、應付總額、本金、利息、剩餘本金五個欄位
- **FR-026**: 還款明細表的每期資料必須依據選擇的還款方式（等額本息或等額本金）正確計算
- **FR-027**: 還款明細表最後一期的剩餘本金必須為 0（容許四捨五入誤差小於 10 元）
- **FR-028**: 當還款期數超過 60 期時，系統必須提供分頁或虛擬捲動機制以維持介面效能
- **FR-029**: 系統必須提供跳轉或篩選功能，讓使用者可快速查看特定期數的還款明細

**數字格式化相關**

- **FR-030**: 系統必須將所有金額數值以千分位格式顯示（例如：8,000,000 元）
- **FR-031**: 使用者輸入金額時，系統必須即時格式化為千分位顯示
- **FR-032**: 系統必須在試算結果區域提供簡短說明文字，描述關鍵資訊（如總利息金額的意義）
- **FR-033**: 當使用者修改貸款年限時，系統應顯示與其他常見年限（20年、30年）的比較說明

**A/B 方案比較相關**

- **FR-034**: 系統必須支援同時設定兩個貸款方案（方案 A 與方案 B）進行比較
- **FR-035**: 系統必須提供「新增比較方案」按鈕，讓使用者建立第二個方案
- **FR-036**: 系統必須提供「複製到方案 B」功能，將方案 A 的所有參數複製到方案 B
- **FR-037**: 系統必須提供「交換 A/B」功能，互換兩個方案的位置
- **FR-038**: 系統必須提供「清除方案」功能，清空指定方案的所有參數
- **FR-039**: 當修改任一方案的參數時，比較結果必須即時更新
- **FR-040**: 系統必須以並排表格方式顯示兩方案的關鍵數據對比
- **FR-041**: 比較表格必須包含：每月還款金額、總還款金額、總利息、貸款年限、利率
- **FR-042**: 比較表格必須顯示每個項目的差異值（方案 B - 方案 A）
- **FR-043**: 差異值必須使用顏色區分：節省為綠色、增加為紅色
- **FR-044**: 系統必須顯示總利息差異的文字說明（例如：「方案 B 可省下 50 萬利息」）
- **FR-045**: 系統必須顯示每月還款差異的文字說明（例如：「方案 B 每月多付 13,397 元」）
- **FR-046**: 系統必須顯示利率差異提示，說明利率差對總成本的影響
- **FR-047**: 當兩方案年限不同時，系統必須顯示還款壓力與總成本的權衡說明
- **FR-048**: 當兩方案條件完全相同時，系統必須顯示「兩方案條件相同」提示
- **FR-049**: 系統必須提供比較圖表，在同一圖表中顯示兩方案的還款曲線
- **FR-050**: 比較圖表必須支援切換不同的圖表類型：還款曲線、累計利息、每月對比
- **FR-051**: 比較圖表必須支援滑鼠懸停顯示詳細數值（Tooltip）
- **FR-052**: 比較圖表必須使用不同顏色區分方案 A 與方案 B，並提供圖例說明
- **FR-053**: 系統必須提供「產生摘要」功能，將比較結果轉為文字格式
- **FR-054**: 系統必須提供「複製到剪貼簿」功能
- **FR-055**: 系統必須提供「截圖」功能，將比較表格產生為圖片檔案
- **FR-056**: 系統必須在兩方案皆完成輸入後才啟用比較功能
- **FR-057**: 系統必須在輸入不完整時禁用比較功能並顯示提示
- **FR-058**: 系統必須對快速連續的參數修改進行節流處理，避免過度計算

**儲存試算結果相關**

- **FR-059**: 系統必須提供「儲存此結果」功能，將試算條件與結果儲存至本機（localStorage）
- **FR-060**: 系統必須提供「已儲存的試算」列表，顯示每組結果的摘要（貸款金額、年限、每月還款）
- **FR-061**: 系統必須提供「載入」功能，從儲存的結果中還原試算條件
- **FR-062**: 系統必須提供「刪除」功能，移除已儲存的試算結果
- **FR-063**: 當儲存結果超過 10 組時，系統必須提供篩選或排序功能
- **FR-064**: 系統必須限制最大儲存數量為 50 組，並在達到上限時提示使用者

**房貸負擔能力檢查相關**

- **FR-065**: 系統必須提供每月收入輸入欄位
- **FR-066**: 系統必須根據每月收入計算建議最高月付款金額（預設為收入的 30%）
- **FR-067**: 系統必須根據當前利率與年限設定，計算建議最高貸款金額
- **FR-068**: 當建議月付款超過收入 30% 時，系統必須以視覺化方式顯示風險警示
- **FR-069**: 系統必須提供「套用建議金額」功能，將建議貸款金額填入試算欄位
- **FR-070**: 當使用者修改利率或年限時，建議貸款金額必須即時更新

**自備款計算相關**

- **FR-071**: 系統必須在輸入房屋總價與貸款成數後，自動計算並顯示自備款金額
- **FR-072**: 系統必須顯示自備款占房屋總價的百分比
- **FR-073**: 當使用者修改貸款成數時，自備款金額必須即時更新
- **FR-074**: 當使用者使用「貸款金額」模式且有輸入房屋總價時，系統必須反推並顯示自備款比例
- **FR-075**: 當自備款比例低於 20% 時，系統必須顯示提示說明

**驗證相關**

- **FR-076**: 系統必須驗證所有必填欄位已填寫後才能進行試算
- **FR-077**: 系統必須驗證輸入數值為有效的正數
- **FR-078**: 系統必須驗證貸款成數在 1% 至 100% 之間

### Key Entities

- **貸款條件（Loan Parameters）**: 包含房屋總價、貸款金額、貸款成數、年限、利率、利率類型（固定/浮動）、還款方式等計算所需的輸入參數
- **利率設定（Interest Rate Settings）**: 包含利率類型、基準利率、浮動利率的預估調整幅度等利率相關參數
- **試算結果（Calculation Result）**: 包含每月還款金額、總還款金額、總利息金額、利率變動影響說明等計算輸出
- **首月還款明細（First Month Breakdown）**: 包含首月應付總額、首月利息金額、首月本金金額、利息占比、本金占比
- **還款曲線資料（Repayment Chart Data）**: 包含每期（月）的本金金額、利息金額、累計已還本金、累計已還利息，用於繪製折線圖
- **還款明細表（Amortization Schedule）**: 包含每期（月）的期數、應付總額、當期本金、當期利息、剩餘本金的完整清單
- **格式化設定（Display Format Settings）**: 包含千分位顯示規則、貨幣符號、小數位數等顯示格式設定
- **比較方案組（Comparison Set）**: 包含方案 A 與方案 B 的完整貸款條件，用於執行比較分析
- **差異分析結果（Difference Analysis）**: 包含每月還款差異、總利息差異、總還款差異、利率差異等計算結果
- **比較提示文字（Comparison Insights）**: 根據差異分析結果產生的使用者友善說明文字
- **比較圖表資料（Chart Comparison Data）**: 包含兩方案的時間序列資料，用於繪製比較圖表
- **方案比較（Loan Comparison）**: 包含兩組貸款條件（方案 A 與方案 B）、各自的試算結果、以及差異比較資料
- **儲存的試算記錄（Saved Calculation Record）**: 包含儲存時間戳記、貸款條件、試算結果摘要，用於本機持久化儲存
- **負擔能力評估（Affordability Assessment）**: 包含每月收入、建議月付款比例（預設 30%）、建議最高月付款金額、建議最高貸款金額、風險等級
- **自備款資訊（Down Payment Info）**: 包含房屋總價、貸款金額、自備款金額、自備款比例

### Assumptions

- 利率為年利率，系統內部轉換為月利率進行計算
- 貸款年限以「年」為單位，系統內部轉換為月數進行計算
- 金額單位為新台幣（元），不需處理其他幣別
- 等額本息公式：M = P × [r(1+r)^n] / [(1+r)^n - 1]，其中 M=月付款、P=本金、r=月利率、n=總期數
- 等額本金公式：首月還款 = (P/n) + P×r，之後每月遞減 (P/n)×r
- 固定利率：整個貸款期間利率維持不變
- 浮動利率：利率會隨市場變動，系統提供利率變動對月付款的影響試算（例如利率 +0.5% 或 -0.5% 時的月付款變化）
- 浮動利率試算為模擬情境，實際利率變動依各銀行公告為準
- 千分位格式使用逗號（,）作為分隔符號，符合台灣通用習慣
- 金額顯示預設取到整數位，不顯示小數點
- 比較功能僅支援兩個方案的對比，不支援三個或以上方案的同時比較
- 方案 A 被視為「基準方案」，差異計算以方案 A 為基準（差異 = 方案 B - 方案 A）
- 比較功能建立在現有的單一方案試算功能之上，共用計算邏輯
- 比較資料僅存在於當前瀏覽階段，重新整理頁面會清除比較資料（除非有儲存功能）
- 儲存的試算記錄使用瀏覽器的 localStorage，資料僅儲存於使用者本機
- 儲存記錄上限為 50 組，超過時需手動刪除舊記錄
- 負擔能力檢查預設使用 30% 收入比例作為建議最高月付款，此為常見的房貸負擔建議比例
- 自備款 = 房屋總價 - 貸款金額，自備款比例 = 自備款 / 房屋總價 × 100%

### Constitutional Requirements *(mandatory)*

#### Code Quality (Constitution I)

- [x] Code review process defined
- [x] Static analysis tools configured
- [x] Naming conventions and style guide followed
- [x] SOLID principles considered in design

#### Testing (Constitution II - NON-NEGOTIABLE)

- [x] TDD approach will be followed (red-green-refactor)
- [x] Unit test coverage target: ≥ 80% (critical paths: 100%)
- [x] Integration tests defined for component interactions
- [ ] Contract tests defined for API boundaries（N/A - 純前端應用，無 API 邊界）
- [x] All tests will be written BEFORE implementation

#### User Experience (Constitution III)

- [x] UI components follow design system or have consistency plan
- [x] Accessibility requirements defined (WCAG 2.1 AA)
- [x] Responsive design requirements specified
- [x] Error messages are user-friendly and actionable
- [x] Loading states and async feedback mechanisms planned

#### Performance (Constitution IV)

- [x] Response time targets defined (計算結果應在 100ms 內顯示)
- [x] Performance budget set (bundle size < 200KB gzipped)
- [x] Performance testing strategy planned
- [ ] Monitoring and observability considered（N/A - 初期版本不需要）
- [x] Scalability requirements assessed（純前端計算，無伺服器負載考量）

#### Documentation Language (Constitution V - NON-NEGOTIABLE)

- [x] This specification written in Traditional Chinese
- [x] User-facing documentation will be in Traditional Chinese
- [x] Code comments will be in English (business logic may use Traditional Chinese)
- [x] Internal communication will use Traditional Chinese

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 使用者可在 30 秒內完成一次完整的房貸試算
- **SC-002**: 95% 的使用者首次使用即能成功完成試算，無需額外指引
- **SC-003**: 計算結果與銀行官方試算工具的誤差在 1 元以內
- **SC-004**: 頁面在行動裝置上完全可用，所有功能皆可操作
- **SC-005**: 所有輸入欄位皆有明確的標籤與說明，符合無障礙標準
- **SC-006**: 使用者修改任一輸入參數後，計算結果在 100ms 內即時更新
- **SC-007**: 還款曲線圖在 500ms 內完成繪製
- **SC-008**: 使用者能在 5 秒內從圖表中識別出本金與利息的變化趨勢
- **SC-009**: 還款明細表在 30 年期（360 期）資料量下仍能流暢捲動（FPS ≥ 30）
- **SC-010**: 使用者能在 10 秒內找到並查看任一特定期數的還款明細
- **SC-011**: 所有金額數值正確顯示千分位格式，無格式錯誤
- **SC-012**: 使用者能在 60 秒內完成兩組貸款方案的並排比較
- **SC-013**: 使用者能在 3 秒內識別出兩方案的關鍵差異（月付款、總利息）
- **SC-014**: 90% 的使用者能正確理解比較結果中的差異說明
- **SC-015**: 比較計算結果在 200ms 內即時更新
- **SC-016**: 比較圖表在同一圖表中清晰顯示兩方案的還款曲線
- **SC-017**: 在行動裝置上，比較表格以上下堆疊方式清晰顯示
- **SC-018**: 使用者能在 5 秒內從比較結果中判斷哪個方案總利息較低
- **SC-019**: 產生的比較摘要能在 3 秒內複製到剪貼簿
- **SC-020**: 使用者能在 5 秒內完成儲存當前試算結果的操作
- **SC-021**: 使用者能在 10 秒內從已儲存的記錄中載入並還原先前的試算條件
- **SC-022**: 已儲存的試算記錄在瀏覽器關閉後重新開啟仍可存取
- **SC-023**: 使用者能在 15 秒內完成負擔能力檢查並理解建議結果
- **SC-024**: 負擔能力風險等級能讓 90% 的使用者正確理解其意義
- **SC-025**: 自備款資訊在房屋總價或貸款金額變更後即時更新（100ms 內）
